<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Libomi</title>
    <style>
        /* Nuevo estilo para el logo en el encabezado principal */
.logo-header-container {
    position: absolute; /* Para que el logo se pueda mover independientemente */
    top: 1rem;
    left: 1rem;
    width: 150px;
    height: 75px;
    overflow: visible;
}

.logo-header-container img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    position: absolute;
}
        /* CSS se mantiene dentro de este archivo */
        /* Estilos de la página y catálogo */
        /* Reset básico */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
            background-image: var(--catalog-bg-image, none);
            background-attachment: fixed; /* Mantiene el fondo fijo al hacer scroll */
            background-size: cover;
            background-position: center center;
            background-color: var(--catalog-bg-color, transparent);
        }
        
        /* Contenedor principal para opacidad */
        .main-content {
            background-color: var(--catalog-bg-overlay, rgba(255, 255, 255, 0));
            z-index: 1;
        }

        /* Variables CSS para personalización */
        :root {
            --header-bg-image: none;
            --catalog-bg-image: none;
            --catalog-bg-overlay: transparent;
            --catalog-bg-opacity: 0.8;
            --catalog-text-color: #333;
        }

        /* Nuevo Header Personalizado */
        .custom-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-image: var(--header-bg-image, none);
            background-position: var(--header-bg-position, center center);
            background-size: cover;
            background-blend-mode: overlay;
            color: white;
            padding: 2rem 0;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 1rem;
        }

        .header-title {
            font-size: 2.5rem;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            text-align: center;
        }

        .header-subtitle {
            font-size: 1.2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        /* Contenedor de la imagen personalizable */
        .draggable-image-container {
            width: 300px;
            height: 150px;
            overflow: hidden;
            position: relative;
            cursor: grab;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.2);
            touch-action: none;
            user-select: none;
        }

        .draggable-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            position: absolute;
            left: 0;
            top: 0;
        }

        /* Resto de los estilos se mantienen igual */
        .nav {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 0.5rem 0;
            border-bottom: 1px solid #e0e6ed;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            white-space: nowrap;
        }
        .tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            color: #64748b;
        }
        .tab.active {
            background: #667eea;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        .tab:hover:not(.active) {
            background: #f1f5f9;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .card {
            background: transparent;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        .card h3 {
            margin-bottom: 1rem;
            color: #1e293b;
        }
        .cloud-status {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .cloud-status.connected {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.2);
            color: #16a34a;
        }
        .cloud-status.error {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.2);
            color: #dc2626;
        }
        .github-config {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .github-config label {
            font-weight: 500;
            color: #374151;
            display: block;
            margin-bottom: 0.5rem;
        }
        .github-config input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.875rem;
        }
        .github-config .example {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
            font-family: monospace;
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }
        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background: #5a67d8;
            transform: translateY(-1px);
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        .btn-secondary:hover {
            background: #4b5563;
        }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .btn-danger:hover {
            background: #dc2626;
        }
        .btn-outline {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }
        .btn-outline:hover {
            background: #667eea;
            color: white;
        }
        .image-preview {
            width: 200px;
            height: 200px;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            overflow: hidden;
            background: #f9fafb;
        }
        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-preview.empty {
            color: #6b7280;
            font-size: 0.875rem;
            text-align: center;
            padding: 1rem;
        }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        .product-card {
            background: transparent;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        .product-image {
            width: 100%;
            height: 200px;
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            cursor: zoom-in;
            position: relative;
        }
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: transform 0.3s;
        }
        .product-image:hover img {
            transform: scale(1.1);
        }
        .image-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        .image-modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 8px;
        }
        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
        }
        .product-info {
            padding: 1rem 1.5rem;
            color: #1e293b;
        }
        .product-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .product-category {
            font-size: 0.875rem;
            color: #64748b;
            text-transform: uppercase;
            font-weight: 500;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }
        .product-description {
            font-size: 0.9rem;
            color: #475569;
            margin-bottom: 1rem;
        }
        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1d4ed8;
            margin-bottom: 1rem;
        }
        .product-sku, .product-stock {
            font-size: 0.875rem;
            color: #6b7280;
        }
        .product-stock {
            font-weight: 600;
        }
        .product-stock.low {
            color: #ef4444;
        }
        .product-stock.high {
            color: #16a34a;
        }
        /* Toast Notification */
        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column-reverse;
            align-items: flex-end;
        }
        .toast {
            min-width: 250px;
            background-color: #333;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.5s, transform 0.5s;
            transform: translateY(20px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast.success {
            background-color: #28a745;
        }
        .toast.error {
            background-color: #dc3545;
        }
        .toast.warning {
            background-color: #ffc107;
        }

        .toast-icon {
            font-size: 1.5rem;
        }
        /* Nuevo estilo para las áreas de arrastre */
        .draggable-area {
            position: relative;
            cursor: grab;
            overflow: hidden;
            height: 100px;
            background-color: #f1f5f9;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            margin-top: 0.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .draggable-area img {
            position: absolute;
            width: 100%;
            min-width: 150%;
            min-height: 150%;
            object-fit: cover;
            pointer-events: none;
        }

        .draggable-area:active {
            cursor: grabbing;
        }

        .preview-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        /* Estilos de impresión */
        @media print {
    .nav, .btn, .form-control, .card h3, .product-actions, #toast-container, .cloud-status, .github-config, .form-group, .form-grid, #search-form, .nav, #logo-display {
        display: none !important;
    }

    /* Eliminar la regla que oculta el encabezado personalizado en la impresión */
    .custom-header {
        display: block !important;
        box-shadow: none !important;
        padding: 1rem 0 !important;
        margin-bottom: 1rem !important;
    }
    
    body {
        font-size: 12px;
        background: var(--catalog-bg-color, white) !important; /* Usar el color del catálogo o blanco */
        background-image: var(--catalog-bg-image, none) !important; /* Usar la imagen de fondo si existe */
        color: black !important;
        line-height: 1.4;
    }
    
    .main-content {
        background-color: var(--catalog-bg-overlay, rgba(255, 255, 255, 0.8)) !important;
        z-index: 1;
    }

            .products-grid {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 10px !important;
                page-break-inside: avoid;
            }
            .section {
                display: none;
            }
            .section.active {
                display: block !important;
            }
            #catalogo {
                display: block !important;
            }

            .product-card {
                border: 1px solid #ddd !important;
                border-radius: 8px !important;
                padding: 8px !important;
                margin-bottom: 10px !important;
                page-break-inside: avoid;
                background: white !important;
                box-shadow: none !important;
            }

            .product-image {
                height: 120px !important;
                margin-bottom: 8px !important;
                border: 1px solid #eee !important;
                border-radius: 4px !important;
            }

            .product-image img {
                object-fit: contain !important;
            }

            .product-name {
                font-size: 11px !important;
                font-weight: bold !important;
                margin-bottom: 4px !important;
                color: black !important;
            }
            
            .product-category, .product-description {
                font-size: 9px !important;
                color: #555 !important;
                margin-bottom: 2px !important;
                line-height: 1.2 !important;
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* INICIO: Visibilidad de botones de acción en modo cliente */
        body.client-mode .product-actions,
        body.client-mode .nav,
        body.client-mode .custom-header .header-content .url-info {
            display: none !important;
        }
        body.client-mode #catalogo {
            display: block !important;
        }
        /* FIN: Visibilidad de botones de acción en modo cliente */

        /* Estilos para la sección de respaldo mejorada */
        .sync-section {
            background: #f0f9ff;
            border: 1px solid #38bdf8;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .sync-section h3 {
            color: #0369a1;
            margin-bottom: 1rem;
        }
        
        .sync-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .sync-instructions {
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            padding: 1rem;
            color: #0c4a6e;
            line-height: 1.6;
        }
        
        .sync-instructions ol {
            padding-left: 1.5rem;
        }
        
        .sync-instructions .tip {
            margin-top: 12px;
            padding: 12px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 6px;
        }
        
        @media (max-width: 768px) {
            .sync-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="toast-container"></div>
    <div id="image-modal" class="image-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <img id="modalImage" class="modal-image" src="" alt="Amplified image">
        </div>
    </div>

    <header class="custom-header">
        <div class="header-content">
            <div id="logo-header-container" class="logo-header-container">
    <img id="logo-header-img" src="" alt="Logo del Catálogo">
</div>
            <h1 class="header-title">Catálogo Libomi</h1>
            <p class="header-subtitle">Libomi, la mejor calidad en un solo lugar.</p>
        </div>
    </header>

    <div class="main-content">
        <nav class="nav">
            <div class="nav-content">
                <button class="tab active" onclick="showSection('productos')">Entrada de Datos</button>
                <button class="tab" onclick="showSection('catalogo')">Ver Catálogo</button>
                <button class="tab" onclick="showSection('categorias')">Categorías</button>
                <button class="tab" onclick="showSection('almacenes')">Almacenes</button>
                <button class="tab" onclick="showSection('configuracion')">Configuración</button>
                <button class="tab" onclick="showSection('respaldo')">Sincronización</button>
            </div>
        </nav>
        
        <main class="container">
            <section id="productos" class="section active">
                <div class="cloud-status" id="cloudStatus">
                    <span>📊</span>
                    <span id="cloudStatusText">Estado de sincronización</span>
                    <button class="btn btn-outline" onclick="syncData()" style="margin-left: auto; padding: 0.25rem 0.75rem;">
                        Sincronizar
                    </button>
                </div>

                <div class="card">
                    <h3>Agregar / Editar Producto</h3>
                    <form id="productForm" class="form-grid">
                        <div>
                            <div class="form-group">
                                <label>Nombre *</label>
                                <input type="text" id="productName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label>Código</label>
                                <input type="text" id="productCode" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Almacén *</label>
                                <select id="productWarehouse" class="form-control" required></select>
                            </div>
                            <div class="form-group">
                                <label>Categoría *</label>
                                <select id="productCategory" class="form-control" required></select>
                            </div>
                            <div class="form-group">
                                <label>Subcategoría</label>
                                <select id="productSubcategory" class="form-control"></select>
                            </div>
                            <div class="form-group">
                                <label>Descripción</label>
                                <textarea id="productDescription" class="form-control" rows="4"></textarea>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label>URL de Imagen</label>
                                <input type="url" id="productImageUrl" class="form-control" placeholder="https://ejemplo.com/imagen.jpg">
                            </div>
                            <div class="form-group">
                                <div id="imagePreview" class="image-preview empty">
                                    <span>Ingresa una URL de imagen</span>
                                </div>
                                <button type="button" class="btn btn-outline" onclick="previewImageFromUrl()">Ver Vista Previa</button>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Guardar Producto</button>
                                <button type="button" class="btn btn-secondary" onclick="clearForm()">Limpiar</button>
                                <button type="button" class="btn btn-danger" onclick="deleteCurrentProduct()">Eliminar</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card">
                    <h3>Lista de Productos</h3>
                    <div id="productsList" class="products-grid"></div>
                </div>
            </section>

            <section id="catalogo" class="section">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>Catálogo de Productos</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="printCatalog()">🖨️ Imprimir Catálogo</button>
                            <button class="btn btn-outline" onclick="downloadPDF()">📄 Descargar PDF</button>
                        </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <input type="text" id="searchInput" class="form-control" placeholder="Buscar por nombre, código o almacén...">
                    </div>
                    <div id="catalogContent"></div>
                </div>
            </section>

            <section id="categorias" class="section">
                <div class="card">
                    <h3>Gestión de Categorías</h3>
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <input type="text" id="newCategoryName" class="form-control" placeholder="Nueva categoría">
                        <input type="text" id="newSubcategoryName" class="form-control" placeholder="Nueva subcategoría">
                        <button class="btn btn-primary" onclick="addCategory()">Agregar</button>
                    </div>
                    <div id="categoriesList"></div>
                </div>
            </section>

            <section id="almacenes" class="section">
                <div class="card">
                    <h3>Gestión de Almacenes</h3>
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <input type="text" id="newWarehouseName" class="form-control" placeholder="Nuevo almacén">
                        <button class="btn btn-primary" onclick="addWarehouse()">Agregar</button>
                    </div>
                    <div id="warehousesList"></div>
                </div>
            </section>

            <section id="configuracion" class="section">
                <div class="card">
                    <h3>Personalización de Encabezado y Fondo</h3>
                    <div class="form-group">
                        <label>URL de Imagen del Encabezado</label>
                        <input type="url" id="headerBgUrl" class="form-control" placeholder="https://ejemplo.com/header.jpg">
                    </div>
                    <div class="form-group">
                        <label>URL de Imagen de Fondo del Catálogo</label>
                        <input type="url" id="catalogBgUrl" class="form-control" placeholder="https://ejemplo.com/background.jpg">
                    </div>
                    <div class="form-group">
                        <label>Opacidad del Contenido del Catálogo (0.0 - 1.0)</label>
                        <input type="number" id="catalogOpacity" class="form-control" min="0" max="1" step="0.1" value="0.8">
                    </div>
                    <div class="form-group">
                        <label>Color de Fondo del Catálogo (si no hay imagen)</label>
                        <input type="color" id="catalogBgColor" class="form-control" value="#f5f7fa">
                    </div>
                </div>
                <div class="card">
                    <h3>Personalización del Logo</h3>
                    <div class="form-group">
                        <label>URL del Logo</label>
                        <input type="url" id="logoUrl" class="form-control" placeholder="https://ejemplo.com/logo.png">
                    </div>
                    <div id="logo-display" class="draggable-image-container">
                        <img id="logoImage" class="draggable-image" src="" alt="Logo">
                        <div style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.5); color: white; padding: 3px 8px; border-radius: 4px; font-size: 10px;">Arrastrar</div>
                    </div>
                    <input type="hidden" id="logoPositionX">
                    <input type="hidden" id="logoPositionY">
                </div>
                <button class="btn btn-primary" onclick="saveConfig()">Guardar Configuración</button>
            </section>

            <section id="respaldo" class="section">
                <div class="sync-section">
                    <h3>📄 Cómo sincronizar entre ordenadores</h3>
                    <div class="sync-instructions">
                        <ol>
                            <li><strong>En el ordenador A:</strong> Ve a "Sincronización" → "Generar Exportación" → Copia los datos</li>
                            <li><strong>Comparte los datos:</strong> Email, WhatsApp, USB, etc.</li>
                            <li><strong>En el ordenador B:</strong> Ve a "Sincronización" → Pega los datos → "Importar Datos"</li>
                            <li><strong>¡Listo!</strong> Todos tus productos, categorías y almacenes estarán disponibles</li>
                        </ol>
                        <div class="tip">
                            💡 <strong>Tip:</strong> Exporta tus datos regularmente como respaldo
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Exportar / Importar Datos</h3>
                    <p style="color: #666; margin-bottom: 1rem;">
                        Usa estas funciones para mantener tus datos sincronizados entre diferentes ordenadores.
                    </p>
                    <div class="sync-grid">
                        <div>
                            <label><strong>📤 Exportar datos (copiar):</strong></label>
                            <textarea id="exportDataTextarea" class="form-control" rows="10" readonly placeholder="Haz clic en 'Generar Exportación' para ver los datos aquí"></textarea>
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button class="btn btn-primary" onclick="exportData()">Generar Exportación</button>
                                <button class="btn btn-outline" onclick="copyToClipboard('exportDataTextarea')">Copiar al Portapapeles</button>
                            </div>
                        </div>
                        <div>
                            <label><strong>📥 Importar datos (pegar):</strong></label>
                            <textarea id="importDataTextarea" class="form-control" rows="10" placeholder="Pega aquí los datos exportados desde otro ordenador"></textarea>
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button class="btn btn-primary" onclick="importData()">Importar Datos</button>
                                <button class="btn btn-outline" onclick="pasteFromClipboard('importDataTextarea')">Pegar del Portapapeles</button>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 2rem; text-align: center; padding-top: 2rem; border-top: 1px solid #e5e7eb;">
                        <button class="btn btn-danger" onclick="confirmReset()">🗑️ Borrar Todos los Datos</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Variables globales
        let products = [];
        let warehouses = [];
        let categories = [];
        let subcategories = {};
        let config = {
            logoUrl: '',
            headerBgUrl: '',
            catalogBgUrl: '',
            catalogBgColor: '#f5f7fa',
            catalogOpacity: 0.8,
            logoPositionX: 0,
            logoPositionY: 0
        };
        let currentEditId = null;

        // Utilidades para notificaciones (toasts)
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.classList.add('toast', type);
            
            let icon = '✓';
            if (type === 'error') icon = '✗';
            if (type === 'warning') icon = '⚠';
            
            toast.innerHTML = `<span class="toast-icon">${icon}</span><span>${message}</span>`;
            toastContainer.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 500);
            }, 5000);
        }

        // --- Lógica de la interfaz de usuario ---
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            const activeTab = document.querySelector(`[onclick="showSection('${sectionId}')"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }

            if (sectionId === 'respaldo') {
                // Auto-generar exportación al abrir la sección
                setTimeout(exportData, 100);
            }
            if (sectionId === 'catalogo') {
                renderCatalog();
            }
            if (sectionId === 'categorias') {
                renderCategoryLists();
            }
            if (sectionId === 'almacenes') {
                renderWarehouseList();
            }
        }

        // Funciones de guardado y carga de datos
        function saveData() {
            try {
                localStorage.setItem('libomi_products_v3', JSON.stringify(products));
                localStorage.setItem('libomi_categories_v3', JSON.stringify(categories));
                localStorage.setItem('libomi_warehouses_v3', JSON.stringify(warehouses));
                localStorage.setItem('libomi_subcategories_v3', JSON.stringify(subcategories));
                localStorage.setItem('libomi_config_v3', JSON.stringify(config));
                updateCloudStatus();
            } catch (e) {
                console.error('Error guardando en localStorage', e);
                showToast('No se pudo guardar localmente', 'error');
            }
        }

        function loadData() {
            try {
                const storedProducts = localStorage.getItem('libomi_products_v3');
                const storedCategories = localStorage.getItem('libomi_categories_v3');
                const storedWarehouses = localStorage.getItem('libomi_warehouses_v3');
                const storedSubcategories = localStorage.getItem('libomi_subcategories_v3');
                const storedConfig = localStorage.getItem('libomi_config_v3');

                if (storedProducts) products = JSON.parse(storedProducts);
                if (storedCategories) categories = JSON.parse(storedCategories);
                if (storedWarehouses) warehouses = JSON.parse(storedWarehouses);
                if (storedSubcategories) subcategories = JSON.parse(storedSubcategories);
                if (storedConfig) config = JSON.parse(storedConfig);

                // Datos por defecto si no existen
                if (warehouses.length === 0) {
                    warehouses = ['Almacén Principal'];
                }
                if (categories.length === 0) {
                    categories = ['General', 'Electrónicos', 'Ropa'];
                }
                if (Object.keys(subcategories).length === 0) {
                    subcategories = {
                        'General': ['Varios'],
                        'Electrónicos': ['Móviles', 'Ordenadores'],
                        'Ropa': ['Hombre', 'Mujer']
                    };
                }

                renderWarehouses();
                renderCategories();
                renderProducts();
                renderCatalog();
                loadConfig();
                updateCloudStatus();
            } catch (e) {
                console.error('Error cargando datos', e);
                showToast('Error cargando datos guardados', 'error');
            }
        }

        function updateCloudStatus() {
            const status = document.getElementById('cloudStatus');
            const statusText = document.getElementById('cloudStatusText');
            if (!status || !statusText) return;

            const totalItems = products.length + Object.keys(categories).length + warehouses.length;
            const lastSync = localStorage.getItem('libomi_last_sync');

            if (lastSync) {
                const syncDate = new Date(lastSync);
                statusText.textContent = `Última sincronización: ${syncDate.toLocaleString()} (${totalItems} elementos)`;
                status.className = 'cloud-status connected';
            } else {
                statusText.textContent = `${totalItems} elementos guardados localmente - Sin sincronizar`;
                status.className = 'cloud-status';
            }
        }

        function syncData() {
            localStorage.setItem('libomi_last_sync', new Date().toISOString());
            updateCloudStatus();
            showToast('Datos sincronizados localmente');
        }

        // Generar ID único para productos
        function generateId() {
            return 'prod_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function clearForm() {
            document.getElementById('productForm').reset();
            document.getElementById('imagePreview').innerHTML = '<span>Ingresa una URL de imagen</span>';
            document.getElementById('imagePreview').classList.add('empty');
            currentEditId = null;
            updateSubcategorySelect('');
        }

        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                currentEditId = productId;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCode').value = product.code || '';
                document.getElementById('productWarehouse').value = product.warehouse;
                document.getElementById('productCategory').value = product.category;
                updateSubcategorySelect(product.category, product.subcategory);
                document.getElementById('productImageUrl').value = product.imageUrl || '';
                document.getElementById('productDescription').value = product.description || '';
                previewImageFromUrl();
                showToast('Producto cargado para editar', 'warning');
                showSection('productos');
            }
        }

        function deleteProduct(productId) {
            if (confirm('¿Estás seguro de que quieres eliminar este producto?')) {
                products = products.filter(p => p.id !== productId);
                saveData();
                renderProducts();
                renderCatalog();
                showToast('Producto eliminado', 'warning');
            }
        }

        function deleteCurrentProduct() {
            if (currentEditId) {
                deleteProduct(currentEditId);
                clearForm();
            } else {
                showToast('No hay producto seleccionado para eliminar', 'error');
            }
        }

        // --- Lógica del Catálogo (Ver Catálogo) ---
        function renderCatalog() {
            const catalogContent = document.getElementById('catalogContent');
            if (!catalogContent) return;
            
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            catalogContent.innerHTML = '';
            
            const filteredProducts = products.filter(p => 
                (p.name && p.name.toLowerCase().includes(searchTerm)) ||
                (p.code && p.code.toLowerCase().includes(searchTerm)) ||
                (p.warehouse && p.warehouse.toLowerCase().includes(searchTerm))
            );

            if (filteredProducts.length === 0) {
                catalogContent.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 2rem;">No se encontraron productos que coincidan con la búsqueda.</p>';
                return;
            }

            // Agrupar productos primero por almacén y luego por categoría
            const productsByWarehouse = filteredProducts.reduce((acc, p) => {
                const warehouse = p.warehouse || 'Sin Almacén';
                if (!acc[warehouse]) {
                    acc[warehouse] = {};
                }
                const category = p.category || 'Sin Categoría';
                if (!acc[warehouse][category]) {
                    acc[warehouse][category] = [];
                }
                acc[warehouse][category].push(p);
                return acc;
            }, {});
            
            // Generar la visualización
            for (const warehouse in productsByWarehouse) {
                const warehouseSection = document.createElement('div');
                warehouseSection.className = 'warehouse-section';
                warehouseSection.innerHTML = `<h2 style="color: #1d4ed8; font-size: 2rem; margin: 2rem 0 1rem 0; padding-bottom: 0.5rem; border-bottom: 3px solid #667eea;">Almacén: ${escapeHtml(warehouse)}</h2>`;
                
                for (const category in productsByWarehouse[warehouse]) {
                    const categorySection = document.createElement('div');
                    categorySection.className = 'category-section';
                    categorySection.innerHTML = `<h4 style="color: #1e293b; font-size: 1.5rem; margin: 2rem 0 1rem 0; padding-bottom: 0.5rem; border-bottom: 2px solid #e5e7eb;">${escapeHtml(category)}</h4>`;

                    const categoryGrid = document.createElement('div');
                    categoryGrid.className = 'products-grid';

                    productsByWarehouse[warehouse][category].forEach(product => {
                        categoryGrid.appendChild(createProductCard(product, true));
                    });
                    categorySection.appendChild(categoryGrid);
                    warehouseSection.appendChild(categorySection);
                }
                catalogContent.appendChild(warehouseSection);
            }
        }
        
        function createProductCard(product, isCatalogView = false) {
            const card = document.createElement('div');
            card.className = 'product-card';

            const imageUrl = product.imageUrl || '';
            const description = product.description || '';

            card.innerHTML = `
                <div class="product-image" onclick="openModal('${imageUrl}')">
                    <img src="${imageUrl}" alt="${escapeHtml(product.name)}" onerror="this.src='https://via.placeholder.com/300x200.png?text=Sin+Imagen';" loading="lazy">
                </div>
                <div class="product-info">
                    <div class="product-category">${escapeHtml(product.category)}</div>
                    <div class="product-name">${escapeHtml(product.name)}</div>
                    <div class="product-description">${escapeHtml(description)}</div>
                    <div class="product-sku">CODIGO: ${escapeHtml(product.code || 'N/A')}</div>
                    ${!isCatalogView ? `<div class="product-actions" style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary" onclick="editProduct('${product.id}')">Editar</button>
                        <button class="btn btn-danger" onclick="deleteProduct('${product.id}')">Eliminar</button>
                    </div>` : ''}
                </div>
            `;
            return card;
        }

        function renderProducts() {
            const productsList = document.getElementById('productsList');
            if (!productsList) return;
            
            productsList.innerHTML = '';
            
            if (products.length === 0) {
                productsList.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 2rem;">No hay productos registrados.</p>';
                return;
            }

            products.forEach(product => {
                productsList.appendChild(createProductCard(product));
            });
        }

        // --- Lógica de Categorías y Almacenes ---
        function addCategory() {
            const newCategoryName = document.getElementById('newCategoryName').value.trim();
            const newSubcategoryName = document.getElementById('newSubcategoryName').value.trim();
            
            if (newCategoryName) {
                if (!categories.includes(newCategoryName)) {
                    categories.push(newCategoryName);
                    showToast(`Categoría "${newCategoryName}" agregada.`);
                }
                if (newSubcategoryName) {
                    if (!subcategories[newCategoryName]) {
                        subcategories[newCategoryName] = [];
                    }
                    if (!subcategories[newCategoryName].includes(newSubcategoryName)) {
                        subcategories[newCategoryName].push(newSubcategoryName);
                        showToast(`Subcategoría "${newSubcategoryName}" agregada a "${newCategoryName}".`);
                    }
                }
                saveData();
                renderCategories();
                renderCategoryLists();
                document.getElementById('newCategoryName').value = '';
                document.getElementById('newSubcategoryName').value = '';
            } else {
                showToast('Ingresa el nombre de la categoría', 'error');
            }
        }

        function renderCategories() {
            const selectCategory = document.getElementById('productCategory');
            if (!selectCategory) return;
            
            selectCategory.innerHTML = '<option value="">-- Selecciona Categoría --</option>';
            
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                selectCategory.appendChild(option);
            });
        }

        function renderCategoryLists() {
            const categoriesList = document.getElementById('categoriesList');
            if (!categoriesList) return;
            
            categoriesList.innerHTML = '';

            if (categories.length === 0) {
                categoriesList.innerHTML = '<p>No hay categorías registradas.</p>';
                return;
            }

            categories.forEach(cat => {
                const categoryDiv = document.createElement('div');
                categoryDiv.style.marginBottom = '1rem';
                categoryDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <span><strong>${escapeHtml(cat)}</strong></span>
                        <button class="btn btn-danger" onclick="deleteCategory('${escapeHtml(cat)}')" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">Eliminar</button>
                    </div>
                `;
                
                if (subcategories[cat] && subcategories[cat].length > 0) {
                    const subList = document.createElement('div');
                    subList.style.marginLeft = '1rem';
                    subList.style.marginTop = '0.5rem';
                    
                    subcategories[cat].forEach(sub => {
                        const subDiv = document.createElement('div');
                        subDiv.style.marginBottom = '0.25rem';
                        subDiv.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0;">
                                <span>${escapeHtml(sub)}</span>
                                <button class="btn btn-danger" onclick="deleteSubcategory('${escapeHtml(cat)}', '${escapeHtml(sub)}')" style="padding: 0.125rem 0.25rem; font-size: 0.625rem;">×</button>
                            </div>
                        `;
                        subList.appendChild(subDiv);
                    });
                    categoryDiv.appendChild(subList);
                }
                
                categoriesList.appendChild(categoryDiv);
            });
        }
        
        function updateSubcategorySelect(category, selectedSubcategory = '') {
            const selectSubcategory = document.getElementById('productSubcategory');
            if (!selectSubcategory) return;
            
            selectSubcategory.innerHTML = '<option value="">-- Selecciona Subcategoría --</option>';
            
            if (subcategories[category]) {
                subcategories[category].forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub;
                    option.textContent = sub;
                    if (sub === selectedSubcategory) option.selected = true;
                    selectSubcategory.appendChild(option);
                });
            }
        }

        function deleteCategory(cat) {
            if (confirm(`¿Eliminar la categoría "${cat}" y todas sus subcategorías?`)) {
                categories = categories.filter(c => c !== cat);
                delete subcategories[cat];
                products.forEach(product => {
                    if (product.category === cat) {
                        product.category = '';
                        product.subcategory = '';
                    }
                });
                saveData();
                renderCategories();
                renderCategoryLists();
                renderProducts();
                showToast(`Categoría "${cat}" eliminada.`, 'warning');
            }
        }

        function deleteSubcategory(cat, sub) {
            if (confirm(`¿Eliminar la subcategoría "${sub}"?`)) {
                subcategories[cat] = subcategories[cat].filter(s => s !== sub);
                products.forEach(product => {
                    if (product.category === cat && product.subcategory === sub) {
                        product.subcategory = '';
                    }
                });
                saveData();
                renderCategories();
                renderCategoryLists();
                renderProducts();
                showToast(`Subcategoría "${sub}" eliminada.`, 'warning');
            }
        }
        
        function addWarehouse() {
            const newWarehouseName = document.getElementById('newWarehouseName').value.trim();
            if (newWarehouseName && !warehouses.includes(newWarehouseName)) {
                warehouses.push(newWarehouseName);
                saveData();
                renderWarehouses();
                renderWarehouseList();
                document.getElementById('newWarehouseName').value = '';
                showToast(`Almacén "${newWarehouseName}" agregado.`);
            } else if (warehouses.includes(newWarehouseName)) {
                showToast('Este almacén ya existe', 'warning');
            } else {
                showToast('Ingresa el nombre del almacén', 'error');
            }
        }

        function renderWarehouses() {
            const selectWarehouse = document.getElementById('productWarehouse');
            if (!selectWarehouse) return;
            
            selectWarehouse.innerHTML = '<option value="">-- Selecciona Almacén --</option>';

            warehouses.forEach(wh => {
                const option = document.createElement('option');
                option.value = wh;
                option.textContent = wh;
                selectWarehouse.appendChild(option);
            });
        }

        function renderWarehouseList() {
            const warehousesList = document.getElementById('warehousesList');
            if (!warehousesList) return;
            
            warehousesList.innerHTML = '';

            if (warehouses.length === 0) {
                warehousesList.innerHTML = '<p>No hay almacenes registrados.</p>';
                return;
            }

            warehouses.forEach(wh => {
                const warehouseDiv = document.createElement('div');
                warehouseDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: white; border-radius: 8px; margin-bottom: 0.5rem; border: 1px solid #e5e7eb;">
                        <span><strong>${escapeHtml(wh)}</strong></span>
                        <button class="btn btn-danger" onclick="deleteWarehouse('${escapeHtml(wh)}')" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">Eliminar</button>
                    </div>
                `;
                warehousesList.appendChild(warehouseDiv);
            });
        }

        function deleteWarehouse(wh) {
            if (confirm(`¿Eliminar el almacén "${wh}"?`)) {
                warehouses = warehouses.filter(w => w !== wh);
                products.forEach(product => {
                    if (product.warehouse === wh) {
                        product.warehouse = '';
                    }
                });
                saveData();
                renderWarehouses();
                renderWarehouseList();
                renderProducts();
                showToast(`Almacén "${wh}" eliminado.`, 'warning');
            }
        }
        
        // --- Lógica de la Configuración ---
        function loadConfig() {
            const logoUrl = document.getElementById('logoUrl');
            const headerBgUrl = document.getElementById('headerBgUrl');
            const catalogBgUrl = document.getElementById('catalogBgUrl');
            const catalogOpacity = document.getElementById('catalogOpacity');
            const catalogBgColor = document.getElementById('catalogBgColor');
            const logoImage = document.getElementById('logoImage');
            const logoHeaderImg = document.getElementById('logo-header-img');
            const logoHeaderContainer = document.getElementById('logo-header-container');
            const logoPositionX = document.getElementById('logoPositionX');
            const logoPositionY = document.getElementById('logoPositionY');
            
            if (logoUrl) logoUrl.value = config.logoUrl || '';
            if (headerBgUrl) headerBgUrl.value = config.headerBgUrl || '';
            if (catalogBgUrl) catalogBgUrl.value = config.catalogBgUrl || '';
            if (catalogOpacity) catalogOpacity.value = config.catalogOpacity || 0.8;
            if (catalogBgColor) catalogBgColor.value = config.catalogBgColor || '#f5f7fa';

            // Aplicar configuración visual
            if (config.headerBgUrl) {
                document.documentElement.style.setProperty('--header-bg-image', `url('${config.headerBgUrl}')`);
            } else {
                document.documentElement.style.setProperty('--header-bg-image', 'none');
            }
            if (config.catalogBgUrl) {
                document.documentElement.style.setProperty('--catalog-bg-image', `url('${config.catalogBgUrl}')`);
            } else {
                document.documentElement.style.setProperty('--catalog-bg-image', 'none');
            }
            
            document.documentElement.style.setProperty('--catalog-bg-overlay', `rgba(255, 255, 255, ${config.catalogOpacity})`);
            document.documentElement.style.setProperty('--catalog-bg-color', config.catalogBgColor);

            if (logoImage && logoHeaderImg && logoHeaderContainer && config.logoUrl) {
                logoImage.src = config.logoUrl;
                logoHeaderImg.src = config.logoUrl;
                logoHeaderContainer.style.display = 'block';
            } else if (logoHeaderContainer) {
                logoHeaderContainer.style.display = 'none';
            }

            // Aplicar posición del logo
            if (logoImage && logoPositionX && logoPositionY) {
                logoImage.style.left = `${config.logoPositionX || 0}px`;
                logoImage.style.top = `${config.logoPositionY || 0}px`;
            }
        }

        function saveConfig() {
            const logoUrl = document.getElementById('logoUrl');
            const headerBgUrl = document.getElementById('headerBgUrl');
            const catalogBgUrl = document.getElementById('catalogBgUrl');
            const catalogOpacity = document.getElementById('catalogOpacity');
            const catalogBgColor = document.getElementById('catalogBgColor');
            const logoPositionX = document.getElementById('logoPositionX');
            const logoPositionY = document.getElementById('logoPositionY');
            
            if (logoUrl) config.logoUrl = logoUrl.value;
            if (headerBgUrl) config.headerBgUrl = headerBgUrl.value;
            if (catalogBgUrl) config.catalogBgUrl = catalogBgUrl.value;
            if (catalogOpacity) config.catalogOpacity = catalogOpacity.value;
            if (catalogBgColor) config.catalogBgColor = catalogBgColor.value;
            if (logoPositionX) config.logoPositionX = parseInt(logoPositionX.value) || 0;
            if (logoPositionY) config.logoPositionY = parseInt(logoPositionY.value) || 0;

            saveData();
            loadConfig();
            showToast('Configuración guardada.');
        }

        // --- Modals y Vistas Previas ---
        function openModal(imageSrc) {
            if (!imageSrc) return;
            const modal = document.getElementById('image-modal');
            const modalImage = document.getElementById('modalImage');
            if (modal && modalImage) {
                modal.style.display = 'flex';
                modalImage.src = imageSrc;
            }
        }
        
        function previewImageFromUrl() {
            const url = document.getElementById('productImageUrl').value;
            const imgPreview = document.getElementById('imagePreview');
            if (!imgPreview) return;
            
            if (url) {
                const img = new Image();
                img.src = url;
                img.onload = () => {
                    imgPreview.innerHTML = `<img src="${url}" alt="Vista previa">`;
                    imgPreview.classList.remove('empty');
                    showToast('Vista previa de la imagen cargada.');
                };
                img.onerror = () => {
                    imgPreview.innerHTML = '<span>Error al cargar imagen</span>';
                    imgPreview.classList.add('empty');
                    showToast('No se pudo cargar la imagen desde la URL.', 'error');
                };
            } else {
                imgPreview.innerHTML = '<span>Ingresa una URL de imagen</span>';
                imgPreview.classList.add('empty');
            }
        }

        // --- Exportación e Importación de Datos ---
        function exportData() {
            const data = {
                products: products,
                categories: categories,
                warehouses: warehouses,
                subcategories: subcategories,
                config: config,
                exportDate: new Date().toISOString(),
                version: 'v3'
            };
            const exportTextarea = document.getElementById('exportDataTextarea');
            if (exportTextarea) {
                exportTextarea.value = JSON.stringify(data, null, 2);
                showToast('Datos exportados - Listo para copiar');
            }
        }

        function importData() {
            const importTextarea = document.getElementById('importDataTextarea');
            if (!importTextarea) return;
            
            const jsonData = importTextarea.value.trim();
            if (!jsonData) {
                showToast('Pega los datos JSON para importar', 'error');
                return;
            }
            
            try {
                const data = JSON.parse(jsonData);
                
                // Validar estructura básica
                if (!data || typeof data !== 'object') {
                    throw new Error('Formato de datos inválido');
                }
                
                // Importar datos
                if (data.products && Array.isArray(data.products)) {
                    products = data.products;
                }
                if (data.categories && Array.isArray(data.categories)) {
                    categories = data.categories;
                } else if (data.categories && typeof data.categories === 'object') {
                    // Mantener compatibilidad con formato anterior
                    categories = Object.keys(data.categories);
                }
                if (data.warehouses && Array.isArray(data.warehouses)) {
                    warehouses = data.warehouses;
                }
                if (data.subcategories && typeof data.subcategories === 'object') {
                    subcategories = data.subcategories;
                }
                if (data.config && typeof data.config === 'object') {
                    config = { ...config, ...data.config };
                }
                
                saveData();
                renderWarehouses();
                renderCategories();
                renderProducts();
                renderCatalog();
                renderWarehouseList();
                renderCategoryLists();
                loadConfig();
                updateCloudStatus();
                showToast('Datos importados exitosamente');
                importTextarea.value = '';
                
            } catch (error) {
                console.error('Error parsing JSON:', error);
                showToast('Error en el formato JSON. Verifica que los datos estén correctos.', 'error');
            }
        }

        // --- Funciones de Copiar/Pegar ---
        async function copyToClipboard(elementId) {
            try {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                const text = element.value;
                if (!text) {
                    showToast('No hay datos para copiar', 'warning');
                    return;
                }
                await navigator.clipboard.writeText(text);
                showToast('Datos copiados al portapapeles');
            } catch (err) {
                console.error('Error copying to clipboard:', err);
                showToast('No se pudo copiar. Selecciona el texto manualmente.', 'error');
            }
        }
        
        async function pasteFromClipboard(elementId) {
            try {
                const text = await navigator.clipboard.readText();
                const element = document.getElementById(elementId);
                if (element) {
                    element.value = text;
                    showToast('Datos pegados desde el portapapeles');
                }
            } catch (err) {
                console.error('Error pasting from clipboard:', err);
                showToast('No se pudo pegar. Pega manualmente con Ctrl+V.', 'error');
            }
        }
        
        // --- Impresión y PDF ---
        function printCatalog() {
            showSection('catalogo');
            setTimeout(() => {
                window.print();
            }, 500);
        }
        
        function downloadPDF() {
            showToast("La funcionalidad de PDF requiere una librería adicional y conexión a internet. Por favor, utiliza la opción de 'Imprimir Catálogo' y guarda como PDF desde tu navegador.", 'warning');
            printCatalog();
        }
        
        function confirmReset() {
            if (confirm("¿Estás seguro de que quieres ELIMINAR TODOS los datos del catálogo? Esta acción es irreversible.")) {
                resetData();
            }
        }
        
        function resetData() {
            localStorage.clear();
            products = [];
            warehouses = ['Almacén Principal'];
            categories = ['General', 'Electrónicos', 'Ropa'];
            subcategories = {
                'General': ['Varios'],
                'Electrónicos': ['Móviles', 'Ordenadores'],
                'Ropa': ['Hombre', 'Mujer']
            };
            config = {
                logoUrl: '',
                headerBgUrl: '',
                catalogBgUrl: '',
                catalogBgColor: '#f5f7fa',
                catalogOpacity: 0.8,
                logoPositionX: 0,
                logoPositionY: 0
            };
            saveData();
            renderWarehouses();
            renderCategories();
            renderProducts();
            renderCatalog();
            renderWarehouseList();
            renderCategoryLists();
            loadConfig();
            updateCloudStatus();
            showToast('Todos los datos han sido eliminados', 'warning');
        }

        // --- Inicialización y Event Listeners ---
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos al inicializar
            loadData();
            
            // Event listener para el formulario de productos
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    const productName = document.getElementById('productName').value.trim();
                    const productCode = document.getElementById('productCode').value.trim();
                    const productWarehouse = document.getElementById('productWarehouse').value;
                    const productCategory = document.getElementById('productCategory').value;
                    const productSubcategory = document.getElementById('productSubcategory').value;
                    const productImageUrl = document.getElementById('productImageUrl').value.trim();
                    const productDescription = document.getElementById('productDescription').value.trim();

                    if (!productName || !productWarehouse || !productCategory) {
                        showToast('Nombre, almacén y categoría son obligatorios', 'error');
                        return;
                    }

                    const productId = currentEditId || generateId();
                    const existingProductIndex = products.findIndex(p => p.id === productId);

                    const productData = {
                        id: productId,
                        name: productName,
                        code: productCode,
                        warehouse: productWarehouse,
                        category: productCategory,
                        subcategory: productSubcategory,
                        imageUrl: productImageUrl,
                        description: productDescription
                    };

                    if (existingProductIndex !== -1) {
                        products[existingProductIndex] = productData;
                        showToast('Producto actualizado correctamente');
                    } else {
                        products.push(productData);
                        showToast('Producto agregado correctamente');
                    }

                    saveData();
                    renderProducts();
                    renderCatalog();
                    clearForm();
                });
            }

            // Event listener para cambio de categoría
            const productCategory = document.getElementById('productCategory');
            if (productCategory) {
                productCategory.addEventListener('change', function(e) {
                    updateSubcategorySelect(e.target.value);
                });
            }

            // Event listener para búsqueda
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', renderCatalog);
            }

            // Event listeners para el modal de imagen
            const modal = document.getElementById('image-modal');
            const closeModal = document.getElementsByClassName('close-modal')[0];
            
            if (closeModal) {
                closeModal.onclick = function() {
                    if (modal) modal.style.display = 'none';
                };
            }
            
            window.onclick = function(event) {
                if (event.target === modal && modal) {
                    modal.style.display = 'none';
                }
            };

            // --- Drag and Drop para el logo ---
            const logoContainer = document.getElementById('logo-display');
            const logoImg = document.getElementById('logoImage');
            const logoPositionX = document.getElementById('logoPositionX');
            const logoPositionY = document.getElementById('logoPositionY');
            
            if (logoContainer && logoImg && logoPositionX && logoPositionY) {
                let isDragging = false;
                let startX, startY, imgStartX, imgStartY;

                logoContainer.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    imgStartX = logoImg.offsetLeft;
                    imgStartY = logoImg.offsetTop;
                    logoContainer.style.cursor = 'grabbing';
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;
                    const newX = imgStartX + dx;
                    const newY = imgStartY + dy;

                    const containerWidth = logoContainer.offsetWidth;
                    const containerHeight = logoContainer.offsetHeight;
                    const imgWidth = logoImg.offsetWidth;
                    const imgHeight = logoImg.offsetHeight;

                    // Restricciones para que la imagen no salga del contenedor
                    let finalX = Math.min(Math.max(newX, -imgWidth + containerWidth), 0);
                    let finalY = Math.min(Math.max(newY, -imgHeight + containerHeight), 0);

                    logoImg.style.left = `${finalX}px`;
                    logoImg.style.top = `${finalY}px`;
                    logoPositionX.value = finalX;
                    logoPositionY.value = finalY;
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                    logoContainer.style.cursor = 'grab';
                });
            }
        });
    </script>
</body>
</html>
