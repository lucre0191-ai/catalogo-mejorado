<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Catálogo Libomi - Gestión</title><style> /* Reset básico */ * { box-sizing: border-box; margin: 0; padding: 0; } body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; color: #333; line-height: 1.6; } /* Header */ .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); } .header-content { max-width: 1200px; margin: 0 auto; padding: 0 1rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; } .logo { max-width: 150px; max-height: 80px; object-fit: contain; border-radius: 8px; border: 2px solid rgba(255,255,255,0.2); } .header-title { flex: 1; text-align: center; font-size: 1.5rem; font-weight: 600; } .logo-controls { display: flex; gap: 0.5rem; } .url-info { background: rgba(255,255,255,0.15); color: #fff; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-family: monospace; word-break: break-all; } /* Navegación */ .nav { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 0.5rem 0; border-bottom: 1px solid #e0e6ed; } .nav-content { max-width: 1200px; margin: 0 auto; padding: 0 1rem; display: flex; gap: 0.5rem; } .tab { padding: 0.75rem 1.5rem; border: none; background: transparent; border-radius: 25px; cursor: pointer; font-weight: 500; transition: all 0.3s; color: #64748b; } .tab.active { background: #667eea; color: white; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3); } .tab:hover:not(.active) { background: #f1f5f9; } /* Container principal */ .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; } /* Secciones */ .section { display: none; } .section.active { display: block; } /* Cards */ .card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 1.5rem; } .card h3 { margin-bottom: 1rem; color: #1e293b; } /* Formulario */ .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; } .form-group { margin-bottom: 1rem; } .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151; } .form-control { width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; } .form-control:focus { outline: none; border-color: #667eea; } textarea.form-control { resize: vertical; min-height: 100px; } /* Botones */ .btn { display: inline-flex; align-items: center; justify-content: center; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.3s; text-decoration: none; } .btn:disabled { opacity: 0.6; cursor: not-allowed; } .btn-primary { background: #667eea; color: white; } .btn-primary:hover:not(:disabled) { background: #5a67d8; transform: translateY(-1px); } .btn-secondary { background: #6b7280; color: white; } .btn-secondary:hover { background: #4b5563; } .btn-danger { background: #ef4444; color: white; } .btn-danger:hover { background: #dc2626; } .btn-outline { background: transparent; color: #667eea; border: 2px solid #667eea; } .btn-outline:hover { background: #667eea; color: white; } /* Vista previa de imagen */ .image-preview { width: 200px; height: 200px; border: 2px dashed #d1d5db; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; overflow: hidden; background: #f9fafb; } .image-preview img { width: 100%; height: 100%; object-fit: cover; } .image-preview.empty { color: #6b7280; font-size: 0.875rem; text-align: center; padding: 1rem; } /* Grid de productos */ .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 1.5rem; } .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s; } .product-card:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.15); } .product-image { width: 100%; height: 200px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; overflow: hidden; cursor: pointer; position: relative; } .product-image img { width: 100%; height: 100%; object-fit: contain; transition: transform 0.3s; } .product-image:hover img { transform: scale(1.05); } .product-image::after { content: '🔍 Click para ampliar'; position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; padding: 1rem 0.5rem; text-align: center; font-size: 0.75rem; opacity: 0; transition: opacity 0.3s; } .product-image:hover::after { opacity: 1; } .product-info { padding: 1rem; } .product-title { font-weight: 600; font-size: 1.1rem; margin-bottom: 0.5rem; color: #1e293b; } .product-meta { font-size: 0.875rem; color: #64748b; margin-bottom: 0.5rem; } .product-description { font-size: 0.875rem; color: #4b5563; line-height: 1.5; margin-bottom: 1rem; } .product-actions { display: flex; gap: 0.5rem; padding: 0 1rem 1rem; } /* Toolbar */ .toolbar { display: flex; justify-content: space-between; align-items: center; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; } .search-filters { display: flex; gap: 1rem; align-items: center; } /* Categorías */ .categories-list { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem; } .category-section h4 { margin-bottom: 1rem; color: #1e293b; } .list-container { background: white; border-radius: 8px; border: 1px solid #e5e7eb; max-height: 300px; overflow-y: auto; } .list-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-bottom: 1px solid #f3f4f6; } .list-item:last-child { border-bottom: none; } /* Modal mejorado */ .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); z-index: 1000; align-items: center; justify-content: center; cursor: zoom-out; } .modal.active { display: flex; } .modal-content { position: relative; max-width: 95vw; max-height: 95vh; display: flex; align-items: center; justify-content: center; } .modal-image { max-width: 100%; max-height: 100%; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); cursor: grab; transition: transform 0.3s ease; } .modal-image:active { cursor: grabbing; } .modal-close { position: absolute; top: 1rem; right: 1rem; background: rgba(255,255,255,0.2); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; font-size: 1.25rem; backdrop-filter: blur(10px); transition: background 0.3s, transform 0.2s; } .modal-close:hover { background: rgba(255,255,255,0.3); transform: scale(1.1); } .modal-info { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; padding: 2rem; text-align: center; transform: translateY(100%); transition: transform 0.3s; } .modal.show-info .modal-info { transform: translateY(0); } .zoom-controls { position: absolute; bottom: 20px; right: 20px; display: flex; gap: 8px; flex-direction: column; } .zoom-btn { background: rgba(255,255,255,0.2); border: none; border-radius: 50%; width: 40px; height: 40px; color: white; font-size: 18px; font-weight: bold; cursor: pointer; backdrop-filter: blur(10px); transition: background 0.3s, transform 0.2s; } .zoom-btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.1); } /* Toast */ .toast { position: fixed; top: 2rem; right: 2rem; background: #10b981; color: white; padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); transform: translateX(100%); transition: transform 0.3s; z-index: 1001; } .toast.show { transform: translateX(0); } .toast.error { background: #ef4444; } .toast.warning { background: #f59e0b; } /* Print Header (hidden by default) */ .print-header { display: none; } /* ESTILOS DE IMPRESIÓN MEJORADOS */ @media print { * { -webkit-print-color-adjust: exact !important; color-adjust: exact !important; } html, body { background: #fff !important; color: #000 !important; margin: 0; padding: 0; font-size: 12pt; } /* Ocultar elementos interactivos */ .header, .nav, .toolbar, .btn, input, textarea, .toast, .modal, .product-actions, .logo-controls, .url-info { display: none !important; } /* Mostrar header de impresión */ .print-header { display: flex !important; align-items: center; justify-content: space-between; padding: 20px 0; margin-bottom: 30px; border-bottom: 3px solid #667eea; page-break-after: avoid; } .print-logo { height: 80px; width: auto; border-radius: 8px; border: 2px solid #e5e5e5; } .print-title { flex: 1; text-align: center; font-size: 24pt; font-weight: bold; color: #667eea !important; margin: 0 20px; letter-spacing: 1px; } .print-date { font-size: 12pt; color: #666 !important; text-align: right; } .container { max-width: none !important; padding: 0 !important; } /* Secciones de almacén */ .warehouse-section { page-break-inside: avoid; margin-bottom: 40px; } .warehouse-title { font-size: 20pt !important; font-weight: bold !important; color: #667eea !important; text-align: center; margin: 25px 0 20px 0 !important; padding-bottom: 10px; border-bottom: 3px solid #667eea; page-break-after: avoid; } /* Secciones de categorías */ .category-section { page-break-inside: avoid; margin-bottom: 30px; } .category-title { font-size: 18pt !important; font-weight: bold !important; color: #1e293b !important; margin: 20px 0 10px 0 !important; padding-bottom: 8px; border-bottom: 2px solid #e5e5e5; page-break-after: avoid; } .subcategory-title { font-size: 16pt !important; font-weight: 600 !important; color: #4b5563 !important; margin: 15px 0 10px 0 !important; page-break-after: avoid; } .products-grid { display: grid !important; grid-template-columns: repeat(2, 1fr) !important; gap: 15px !important; margin-bottom: 25px; } .product-card { width: 100% !important; margin: 0 !important; box-shadow: none !important; border: 1px solid #ddd !important; border-radius: 8px !important; overflow: hidden; page-break-inside: avoid; break-inside: avoid; } .product-image { height: 120px !important; width: 100% !important; } .product-image::after { display: none !important; } .product-image img { width: 100% !important; height: 100% !important; object-fit: cover !important; transform: none !important; } .product-info { padding: 10px !important; } .product-title { font-size: 14pt !important; font-weight: bold !important; margin: 0 0 4px 0 !important; color: #000 !important; } .product-meta { font-size: 10pt !important; color: #666 !important; margin-bottom: 2px; } .product-description { font-size: 10pt !important; color: #444 !important; line-height: 1.3; margin-top: 4px; } @page { margin: 15mm 12mm; size: A4; } h3, h4, .category-title, .subcategory-title, .warehouse-title { page-break-after: avoid; } } /* Responsive */ @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } .categories-list { grid-template-columns: 1fr; } .toolbar { flex-direction: column; align-items: stretch; } .search-filters { flex-direction: column; } .url-info { display: none; } } </style></head><body><!-- Header de impresión --><div class="print-header"><img alt="Logo" class="print-logo" id="printLogo"/><div class="print-title">CATÁLOGO DE PRODUCTOS - LIBOMI</div><div class="print-date"> Fecha: <span id="printDate"></span></div></div><!-- Modal de imagen mejorado --><div class="modal" id="imageModal"><button class="modal-close" onclick="closeModal()">×</button><div class="modal-content"><img alt="" class="modal-image" id="modalImage"/><div class="modal-info" id="modalInfo"><h3 id="modalTitle"></h3><p id="modalDescription"></p></div></div><div class="zoom-controls"><button class="zoom-btn" id="zoomIn">+</button><button class="zoom-btn" id="zoomOut">−</button><button class="zoom-btn" id="zoomReset">⌂</button></div></div><!-- Toast --><div class="toast" id="toast"></div><!-- Header --><header class="header"><div class="header-content"><img alt="Logo" class="logo" id="logoImage" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60'%3E%3Crect width='100%25' height='100%25' fill='%23f3f4f6'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%239ca3af' font-size='10'%3ESin Logo%3C/text%3E%3C/svg%3E"/><h1 class="header-title">Catálogo de Productos - Libomi</h1><div class="url-info" id="urlDisplay"> 🌐 <span id="currentUrl"></span></div><div class="logo-controls"><input accept="image/*" id="logoInput" style="display: none;" type="file"/><button class="btn btn-outline" onclick="document.getElementById('logoInput').click()"> Cambiar Logo </button><button class="btn btn-secondary" onclick="clearLogo()"> Quitar Logo </button></div></div></header><!-- Navegación --><nav class="nav"><div class="nav-content"><button class="tab active" onclick="showSection('productos')">Entrada de Datos</button><button class="tab" onclick="showSection('catalogo')">Ver Catálogo</button><button class="tab" onclick="showSection('categorias')">Categorías</button><button class="tab" onclick="showSection('almacenes')">Almacenes</button><button class="tab" onclick="showSection('respaldo')">Importar/Exportar</button></div></nav><!-- Contenido principal --><main class="container"><!-- Sección: Productos --><section class="section active" id="productos"><div class="card"><h3>Agregar / Editar Producto</h3><form class="form-grid" id="productForm"><div><div class="form-group"><label>Nombre *</label><input class="form-control" id="productName" required="" type="text"/></div><div class="form-group"><label>Código</label><input class="form-control" id="productCode" type="text"/></div><div class="form-group"><label>Almacén *</label><select class="form-control" id="productWarehouse" required=""></select></div><div class="form-group"><label>Categoría *</label><select class="form-control" id="productCategory" required=""></select></div><div class="form-group"><label>Subcategoría</label><select class="form-control" id="productSubcategory"></select></div><div class="form-group"><label>Descripción</label><textarea class="form-control" id="productDescription" rows="4"></textarea></div><div class="form-group"><button class="btn btn-primary" type="submit">Guardar Producto</button><button class="btn btn-secondary" onclick="clearForm()" type="button">Limpiar</button><button class="btn btn-danger" onclick="deleteCurrentProduct()" type="button">Eliminar</button></div></div><div><div class="form-group"><label>Imagen</label><div class="image-preview empty" id="imagePreview"><span>Selecciona una imagen</span></div><input accept="image/*" class="form-control" id="productImage" type="file"/><small class="form-text text-muted">La imagen se comprimirá automáticamente (máx 1000×1000). Si supera 2MB se mostrará una alerta.</small></div></div></form></div><div class="card"><h3>Lista de Productos</h3><div class="products-grid" id="productsList"></div></div></section><!-- Sección: Catálogo --><section class="section" id="catalogo"><div class="toolbar"><div class="search-filters"><input class="form-control" id="searchInput" placeholder="Buscar productos..." style="width: 300px;" type="search"/><select class="form-control" id="warehouseFilter" style="width: 200px;"><option value="">Todos los almacenes</option></select><select class="form-control" id="categoryFilter" style="width: 200px;"><option value="">Todas las categorías</option></select></div><div style="display: flex; gap: 0.5rem;"><button class="btn btn-secondary" onclick="expandAll()">Expandir Todo</button><button class="btn btn-secondary" onclick="collapseAll()">Colapsar Todo</button><button class="btn btn-primary" onclick="printCatalog()">Imprimir</button></div></div><div id="catalogContent"></div></section><!-- Sección: Categorías --><section class="section" id="categorias"><div class="card"><h3>Gestión de Categorías</h3><div style="display: flex; gap: 1rem; margin-bottom: 1rem;"><input class="form-control" id="newCategoryName" placeholder="Nueva categoría" type="text"/><input class="form-control" id="newSubcategoryName" placeholder="Nueva subcategoría" type="text"/><button class="btn btn-primary" onclick="addCategory()">Agregar</button></div></div><div class="categories-list"><div class="category-section"><h4>Categorías</h4><div class="list-container" id="categoriesList"></div></div><div class="category-section"><h4>Subcategorías</h4><div class="list-container" id="subcategoriesList"></div></div></div></section><!-- Sección: Almacenes --><section class="section" id="almacenes"><div class="card"><h3>Gestión de Almacenes</h3><div style="display: flex; gap: 1rem; margin-bottom: 1rem;"><input class="form-control" id="newWarehouseName" placeholder="Nuevo almacén" type="text"/><button class="btn btn-primary" onclick="addWarehouse()">Agregar</button></div></div><div class="category-section"><h4>Almacenes Registrados</h4><div class="list-container" id="warehousesList"></div></div></section><!-- Sección: Respaldo --><section class="section" id="respaldo"><div class="card"><h3>Importar / Exportar Datos</h3><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;"><div><label>Exportar datos (copiar JSON):</label><textarea class="form-control" id="exportData" readonly="" rows="10"></textarea><button class="btn btn-primary" onclick="exportData()" style="margin-top: 1rem;">Generar Exportación</button></div><div><label>Importar datos (pegar JSON):</label><textarea class="form-control" id="importData" rows="10"></textarea><button class="btn btn-primary" onclick="importData()" style="margin-top: 1rem;">Importar</button></div></div><div style="margin-top: 2rem; text-align: center;"><button class="btn btn-danger" onclick="resetAllData()">Borrar Todos los Datos</button></div></div><!-- Instrucciones para hacer accesible --><div class="card" style="background:#f0f9ff; border:1px solid #38bdf8"><h3 style="color:#0369a1">🌐 Hacer accesible desde cualquier ordenador</h3><div style="color:#0c4a6e; line-height:1.6"><p><strong>Opciones recomendadas (GRATUITAS):</strong></p><ol><li><strong>GitHub Pages:</strong> Sube este archivo HTML a GitHub → Settings → Pages</li><li><strong>Netlify:</strong> Ve a <code>netlify.com</code> → Arrastra el archivo → Obtén URL</li><li><strong>Vercel:</strong> Similar a Netlify, muy fácil de usar</li></ol><p><strong>Para red local:</strong> Comparte la URL que aparece arriba en el header</p><p style="margin-top:12px; padding:8px; background:rgba(59,130,246,0.1); border-radius:6px"> 💡 <strong>Tip:</strong> Una vez subido a cualquier hosting, podrás acceder desde cualquier dispositivo con internet </p></div></div></section></main><script> // Variables globales let products = JSON.parse(localStorage.getItem('libomi_products_v2') || '[]'); let categories = JSON.parse(localStorage.getItem('libomi_categories_v2') || '{"General": ["Varios"]}'); let warehouses = JSON.parse(localStorage.getItem('libomi_warehouses_v2') || '["Almacén Principal"]'); let currentEditId = null; // Variables para lightbox con zoom let currentZoom = 1; let isDragging = false; let startX, startY, currentX = 0, currentY = 0; // Placeholder para imágenes const PLACEHOLDER = 'data:image/svg+xml;utf8,' + encodeURIComponent( `<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300"><rect width="100%" height="100%" fill="#f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="16" font-family="Arial">Sin imagen</text></svg>` ); // Inicialización document.addEventListener('DOMContentLoaded', function() { // Migrar datos antiguos si existen migrateOldData(); loadLogo(); updateUrlDisplay(); renderWarehouses(); renderCategories(); renderProducts(); renderCatalog(); updatePrintHeader(); initLightbox(); // Event listeners document.getElementById('logoInput').addEventListener('change', handleLogoChange); document.getElementById('productForm').addEventListener('submit', saveProduct); document.getElementById('productImage').addEventListener('change', handleImagePreview); document.getElementById('productCategory').addEventListener('change', loadSubcategories); document.getElementById('searchInput').addEventListener('input', renderCatalog); document.getElementById('warehouseFilter').addEventListener('change', renderCatalog); document.getElementById('categoryFilter').addEventListener('change', renderCatalog); }); // Migración de datos antiguos function migrateOldData() { const oldProducts = localStorage.getItem('libomi_products'); const oldCategories = localStorage.getItem('libomi_categories'); const oldLogo = localStorage.getItem('libomi_logo'); if (oldProducts && !localStorage.getItem('libomi_products_v2')) { localStorage.setItem('libomi_products_v2', oldProducts); products = JSON.parse(oldProducts); } if (oldCategories && !localStorage.getItem('libomi_categories_v2')) { localStorage.setItem('libomi_categories_v2', oldCategories); categories = JSON.parse(oldCategories); } if (oldLogo && !localStorage.getItem('libomi_logo_v2')) { localStorage.setItem('libomi_logo_v2', oldLogo); } } // Funciones de utilidad function showToast(message, type = 'success') { const toast = document.getElementById('toast'); toast.textContent = message; toast.className = `toast ${type === 'error' ? 'error' : type === 'warning' ? 'warning' : ''}`; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 3000); } function updateUrlDisplay() { const urlElement = document.getElementById('currentUrl'); if (urlElement) { urlElement.textContent = window.location.href; } } function showSection(sectionName) { // Ocultar todas las secciones document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); // Mostrar sección seleccionada document.getElementById(sectionName).classList.add('active'); event.target.classList.add('active'); // Actualizar contenido si es necesario if (sectionName === 'catalogo') { renderCatalog(); } else if (sectionName === 'categorias') { renderCategoryLists(); } else if (sectionName === 'almacenes') { renderWarehouseList(); } } function generateId() { return 'prod_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9); } function saveData() { try { localStorage.setItem('libomi_products_v2', JSON.stringify(products)); localStorage.setItem('libomi_categories_v2', JSON.stringify(categories)); localStorage.setItem('libomi_warehouses_v2', JSON.stringify(warehouses)); } catch (e) { console.error('Error guardando en localStorage', e); showToast('No se pudo guardar localmente', 'error'); } } function escapeHtml(text) { if (!text) return ''; return String(text) .replace(/&/g, '&amp;') .replace(/</g, '&lt;') .replace(/>/g, '&gt;') .replace(/"/g, '&quot;') .replace(/'/g, '&#39;'); } // Funciones del logo function loadLogo() { const savedLogo = localStorage.getItem('libomi_logo_v2') || localStorage.getItem('libomi_logo'); const defaultLogo = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60'%3E%3Crect width='100%25' height='100%25' fill='%23f3f4f6'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%239ca3af' font-size='10'%3ESin Logo%3C/text%3E%3C/svg%3E"; if (savedLogo) { document.getElementById('logoImage').src = savedLogo; document.getElementById('printLogo').src = savedLogo; } else { document.getElementById('logoImage').src = defaultLogo; document.getElementById('printLogo').src = defaultLogo; } } function handleLogoChange(event) { const file = event.target.files[0]; if (!file) return; if (file.size > 2 * 1024 * 1024) { showToast('Imagen > 2MB: se comprimirá al guardar', 'warning', 3000); } compressImage(file, 600, 600, 0.85) .then(logoData => { document.getElementById('logoImage').src = logoData; document.getElementById('printLogo').src = logoData; localStorage.setItem('libomi_logo_v2', logoData); showToast('Logo actualizado'); }) .catch(err => { console.error(err); showToast('No se pudo procesar logo', 'error'); }); } function clearLogo() { const defaultLogo = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60'%3E%3Crect width='100%25' height='100%25' fill='%23f3f4f6'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%239ca3af' font-size='10'%3ESin Logo%3C/text%3E%3C/svg%3E"; document.getElementById('logoImage').src = defaultLogo; document.getElementById('printLogo').src = defaultLogo; localStorage.removeItem('libomi_logo_v2'); showToast('Logo eliminado', 'warning'); } // Funciones de compresión de imagen function compressImage(file, maxW = 1000, maxH = 1000, quality = 0.75) { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.onerror = () => reject(new Error('Error leyendo archivo')); reader.onload = () => { const img = new Image(); img.onload = () => { let w = img.width, h = img.height; const ratio = Math.min(1, maxW / w, maxH / h); const cw = Math.round(w * ratio), ch = Math.round(h * ratio); const canvas = document.createElement('canvas'); canvas.width = cw; canvas.height = ch; const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, cw, ch); canvas.toBlob(blob => { if (!blob) return reject(new Error('No se generó imagen')); const fr2 = new FileReader(); fr2.onerror = () => reject(new Error('Error leyendo blob')); fr2.onload = () => resolve(fr2.result); fr2.readAsDataURL(blob); }, 'image/jpeg', quality); }; img.onerror = () => reject(new Error('Error cargando imagen')); img.src = reader.result; }; reader.readAsDataURL(file); }); } // Funciones de almacenes function renderWarehouses() { const warehouseSelect = document.getElementById('productWarehouse'); const filterSelect = document.getElementById('warehouseFilter'); // Limpiar selects warehouseSelect.innerHTML = ''; filterSelect.innerHTML = '<option value="">Todos los almacenes</option>'; // Agregar almacenes warehouses.forEach(warehouse => { const option1 = new Option(warehouse, warehouse); const option2 = new Option(warehouse, warehouse); warehouseSelect.add(option1); filterSelect.add(option2); }); } function renderWarehouseList() { const warehousesList = document.getElementById('warehousesList'); let warehousesHtml = ''; warehouses.forEach(warehouse => { warehousesHtml += ` <div class="list-item"><span><strong>${escapeHtml(warehouse)}</strong></span><button class="btn btn-danger" onclick="deleteWarehouse('${escapeHtml(warehouse)}')" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;"> Eliminar </button></div> `; }); warehousesList.innerHTML = warehousesHtml || '<div class="list-item">No hay almacenes</div>'; } function addWarehouse() { const warehouseName = document.getElementById('newWarehouseName').value.trim(); if (!warehouseName) { showToast('Ingresa el nombre del almacén', 'error'); return; } if (warehouses.includes(warehouseName)) { showToast('Este almacén ya existe', 'warning'); return; } warehouses.push(warehouseName); saveData(); renderWarehouses(); renderWarehouseList(); document.getElementById('newWarehouseName').value = ''; showToast('Almacén agregado exitosamente'); } function deleteWarehouse(warehouseName) { if (confirm(`¿Eliminar el almacén "${warehouseName}"?`)) { warehouses = warehouses.filter(w => w !== warehouseName); // Limpiar productos que usen este almacén products.forEach(product => { if (product.warehouse === warehouseName) { product.warehouse = ''; } }); saveData(); renderWarehouses(); renderWarehouseList(); renderProducts(); showToast('Almacén eliminado', 'warning'); } } // Funciones de categorías function renderCategories() { const categorySelect = document.getElementById('productCategory'); const filterSelect = document.getElementById('categoryFilter'); // Limpiar selects categorySelect.innerHTML = ''; filterSelect.innerHTML = '<option value="">Todas las categorías</option>'; // Agregar categorías Object.keys(categories).forEach(cat => { const option1 = new Option(cat, cat); const option2 = new Option(cat, cat); categorySelect.add(option1); filterSelect.add(option2); }); // Cargar subcategorías para la primera categoría if (Object.keys(categories).length > 0) { loadSubcategories(); } } function loadSubcategories() { const categorySelect = document.getElementById('productCategory'); const subcategorySelect = document.getElementById('productSubcategory'); const selectedCategory = categorySelect.value; subcategorySelect.innerHTML = '<option value="">Sin subcategoría</option>'; if (selectedCategory && categories[selectedCategory]) { categories[selectedCategory].forEach(sub => { subcategorySelect.add(new Option(sub, sub)); }); } renderCategoryLists(); } function renderCategoryLists() { const categoriesList = document.getElementById('categoriesList'); const subcategoriesList = document.getElementById('subcategoriesList'); // Renderizar categorías let categoriesHtml = ''; Object.keys(categories).forEach(cat => { categoriesHtml += ` <div class="list-item"><span><strong>${escapeHtml(cat)}</strong></span><button class="btn btn-danger" onclick="deleteCategory('${escapeHtml(cat)}')" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;"> Eliminar </button></div> `; }); categoriesList.innerHTML = categoriesHtml || '<div class="list-item">No hay categorías</div>'; // Renderizar subcategorías let subcategoriesHtml = ''; const selectedCategory = document.getElementById('productCategory').value || Object.keys(categories)[0]; if (selectedCategory && categories[selectedCategory]) { categories[selectedCategory].forEach(sub => { subcategoriesHtml += ` <div class="list-item"><span>${escapeHtml(sub)}</span><button class="btn btn-danger" onclick="deleteSubcategory('${escapeHtml(selectedCategory)}', '${escapeHtml(sub)}')" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;"> Eliminar </button></div> `; }); } subcategoriesList.innerHTML = subcategoriesHtml || '<div class="list-item">No hay subcategorías</div>'; } function addCategory() { const categoryName = document.getElementById('newCategoryName').value.trim(); const subcategoryName = document.getElementById('newSubcategoryName').value.trim(); if (!categoryName) { showToast('Ingresa el nombre de la categoría', 'error'); return; } if (!categories[categoryName]) { categories[categoryName] = []; } if (subcategoryName && !categories[categoryName].includes(subcategoryName)) { categories[categoryName].push(subcategoryName); } saveData(); renderCategories(); document.getElementById('newCategoryName').value = ''; document.getElementById('newSubcategoryName').value = ''; showToast('Categoría agregada exitosamente'); } function deleteCategory(categoryName) { if (confirm(`¿Eliminar la categoría "${categoryName}"?`)) { delete categories[categoryName]; // Limpiar productos que usen esta categoría products.forEach(product => { if (product.category === categoryName) { product.category = ''; product.subcategory = ''; } }); saveData(); renderCategories(); renderProducts(); showToast('Categoría eliminada', 'warning'); } } function deleteSubcategory(categoryName, subcategoryName) { if (confirm(`¿Eliminar la subcategoría "${subcategoryName}"?`)) { categories[categoryName] = categories[categoryName].filter(sub => sub !== subcategoryName); // Limpiar productos que usen esta subcategoría products.forEach(product => { if (product.category === categoryName && product.subcategory === subcategoryName) { product.subcategory = ''; } }); saveData(); renderCategories(); renderProducts(); showToast('Subcategoría eliminada', 'warning'); } } // Funciones de productos function handleImagePreview(event) { const file = event.target.files[0]; const preview = document.getElementById('imagePreview'); if (file) { if (file.size > 2 * 1024 * 1024) { showToast('Imagen > 2MB: se comprimirá al guardar', 'warning', 3000); } const reader = new FileReader(); reader.onload = function(e) { preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`; preview.classList.remove('empty'); }; reader.readAsDataURL(file); } else { preview.innerHTML = '<span>Selecciona una imagen</span>'; preview.classList.add('empty'); } } function saveProduct(event) { event.preventDefault(); const saveButton = event.target.querySelector('button[type="submit"]'); const originalText = saveButton.textContent; saveButton.disabled = true; saveButton.textContent = 'Guardando...'; const name = document.getElementById('productName').value.trim(); const code = document.getElementById('productCode').value.trim(); const warehouse = document.getElementById('productWarehouse').value; const category = document.getElementById('productCategory').value; const subcategory = document.getElementById('productSubcategory').value; const description = document.getElementById('productDescription').value.trim(); const imageFile = document.getElementById('productImage').files[0]; if (!name || !warehouse || !category) { showToast('Nombre, almacén y categoría son obligatorios', 'error'); saveButton.disabled = false; saveButton.textContent = originalText; return; } const productId = currentEditId || generateId(); const existingProductIndex = products.findIndex(p => p.id === productId); const productData = { id: productId, name: name, code: code, warehouse: warehouse, category: category, subcategory: subcategory, description: description, image: null }; if (imageFile) { compressImage(imageFile, 1000, 1000, 0.75) .then(imageData => { productData.image = imageData; saveProductData(productData, existingProductIndex); saveButton.disabled = false; saveButton.textContent = originalText; }) .catch(err => { console.error('Error al comprimir imagen', err); showToast('Error al procesar imagen', 'error'); saveButton.disabled = false; saveButton.textContent = originalText; }); } else { // Si estamos editando y no hay nueva imagen, mantener la anterior if (existingProductIndex !== -1) { productData.image = products[existingProductIndex].image; } else { productData.image = PLACEHOLDER; } saveProductData(productData, existingProductIndex); saveButton.disabled = false; saveButton.textContent = originalText; } } function saveProductData(productData, existingProductIndex) { if (existingProductIndex !== -1) { products[existingProductIndex] = productData; showToast('Producto actualizado'); } else { products.push(productData); showToast('Producto agregado'); } saveData(); renderProducts(); renderCatalog(); clearForm(); } function clearForm() { document.getElementById('productForm').reset(); document.getElementById('imagePreview').innerHTML = '<span>Selecciona una imagen</span>'; document.getElementById('imagePreview').classList.add('empty'); currentEditId = null; loadSubcategories(); } function editProduct(productId) { const product = products.find(p => p.id === productId); if (!product) return; currentEditId = productId; document.getElementById('productName').value = product.name; document.getElementById('productCode').value = product.code || ''; document.getElementById('productWarehouse').value = product.warehouse || ''; document.getElementById('productCategory').value = product.category; loadSubcategories(); document.getElementById('productSubcategory').value = product.subcategory || ''; document.getElementById('productDescription').value = product.description || ''; if (product.image && product.image !== PLACEHOLDER) { const preview = document.getElementById('imagePreview'); preview.innerHTML = `<img src="${product.image}" alt="Preview">`; preview.classList.remove('empty'); } // Cambiar a la pestaña de productos showSection('productos'); document.querySelector('[onclick="showSection(\'productos\')"]').classList.add('active'); showToast('Producto cargado para editar'); window.scrollTo({top: 0, behavior: 'smooth'}); } function deleteProduct(productId) { if (confirm('¿Eliminar este producto?')) { products = products.filter(p => p.id !== productId); saveData(); renderProducts(); renderCatalog(); showToast('Producto eliminado', 'warning'); } } function deleteCurrentProduct() { if (currentEditId) { deleteProduct(currentEditId); clearForm(); } else { showToast('No hay producto seleccionado para eliminar', 'error'); } } function renderProducts() { const container = document.getElementById('productsList'); if (products.length === 0) { container.innerHTML = '<p>No hay productos registrados.</p>'; return; } container.innerHTML = products.map(product => ` <div class="product-card"><div class="product-image" onclick="openModal('${product.image || PLACEHOLDER}', '${escapeHtml(product.name)}', '${escapeHtml(product.description || '')}')"> ${product.image && product.image !== PLACEHOLDER ? `<img src="${product.image}" alt="${escapeHtml(product.name)}">` : '<div style="color: #999; font-size: 0.875rem;">Sin imagen</div>' } </div><div class="product-info"><div class="product-title">${escapeHtml(product.name)}</div><div class="product-meta"> ${product.code ? `Código: ${escapeHtml(product.code)}` : ''} </div><div class="product-meta"> ${escapeHtml(product.warehouse || '')} </div><div class="product-meta"> ${escapeHtml(product.category)}${product.subcategory ? ` / ${escapeHtml(product.subcategory)}` : ''} </div><div class="product-description"> ${escapeHtml(product.description || 'Sin descripción')} </div></div><div class="product-actions"><button class="btn btn-outline" onclick="editProduct('${product.id}')">Editar</button><button class="btn btn-danger" onclick="deleteProduct('${product.id}')">Eliminar</button></div></div> `).join(''); } // Funciones del catálogo function renderCatalog() { const container = document.getElementById('catalogContent'); const searchTerm = (document.getElementById('searchInput').value || '').trim().toLowerCase(); const warehouseFilter = document.getElementById('warehouseFilter').value || ''; const categoryFilter = document.getElementById('categoryFilter').value || ''; // Filtrar productos let filteredProducts = products.filter(product => { const matchesSearch = !searchTerm || product.name.toLowerCase().includes(searchTerm) || (product.code && product.code.toLowerCase().includes(searchTerm)) || (product.description && product.description.toLowerCase().includes(searchTerm)); const matchesWarehouse = !warehouseFilter || product.warehouse === warehouseFilter; const matchesCategory = !categoryFilter || product.category === categoryFilter; return matchesSearch && matchesWarehouse && matchesCategory; }); if (filteredProducts.length === 0) { container.innerHTML = '<p>No se encontraron productos.</p>'; return; } // Agrupar por almacenes, luego por categorías const groupedProducts = {}; filteredProducts.forEach(product => { const warehouse = product.warehouse || 'Sin almacén'; const category = product.category || 'Sin categoría'; const subcategory = product.subcategory || 'General'; if (!groupedProducts[warehouse]) { groupedProducts[warehouse] = {}; } if (!groupedProducts[warehouse][category]) { groupedProducts[warehouse][category] = {}; } if (!groupedProducts[warehouse][category][subcategory]) { groupedProducts[warehouse][category][subcategory] = []; } groupedProducts[warehouse][category][subcategory].push(product); }); // Renderizar agrupados let html = ''; Object.keys(groupedProducts).forEach(warehouse => { html += `<div class="warehouse-section">`; html += `<h2 class="warehouse-title">${escapeHtml(warehouse)}</h2>`; Object.keys(groupedProducts[warehouse]).forEach(category => { html += `<div class="category-section">`; html += `<h3 class="category-title">${escapeHtml(category)}</h3>`; Object.keys(groupedProducts[warehouse][category]).forEach(subcategory => { if (subcategory !== 'General') { html += `<h4 class="subcategory-title" style="margin: 1rem 0 0.5rem; color: #4b5563;">${escapeHtml(subcategory)}</h4>`; } html += `<div class="products-grid">`; groupedProducts[warehouse][category][subcategory].forEach(product => { html += ` <div class="product-card"><div class="product-image" onclick="openModal('${product.image || PLACEHOLDER}', '${escapeHtml(product.name)}', '${escapeHtml(product.description || '')}')"> ${product.image && product.image !== PLACEHOLDER ? `<img src="${product.image}" alt="${escapeHtml(product.name)}">` : '<div style="color: #999; font-size: 0.875rem;">Sin imagen</div>' } </div><div class="product-info"><div class="product-title">${escapeHtml(product.name)}</div><div class="product-meta"> ${product.code ? `Código: ${escapeHtml(product.code)}` : ''} </div><div class="product-description"> ${escapeHtml(product.description || 'Sin descripción')} </div></div></div> `; }); html += `</div>`; }); html += `</div>`; }); html += `</div>`; }); container.innerHTML = html; } function expandAll() { showToast('Expandir: vista ya expandida por defecto'); } function collapseAll() { showToast('Colapsar: no disponible en esta vista'); } // Funciones del modal con zoom mejorado function initLightbox() { const modal = document.getElementById('imageModal'); const modalImage = document.getElementById('modalImage'); const modalClose = modal.querySelector('.modal-close'); const modalTitle = document.getElementById('modalTitle'); const modalDescription = document.getElementById('modalDescription'); const zoomIn = document.getElementById('zoomIn'); const zoomOut = document.getElementById('zoomOut'); const zoomReset = document.getElementById('zoomReset'); // Zoom controls zoomIn.addEventListener('click', (e) => { e.stopPropagation(); currentZoom = Math.min(currentZoom * 1.5, 4); updateImageTransform(); }); zoomOut.addEventListener('click', (e) => { e.stopPropagation(); currentZoom = Math.max(currentZoom / 1.5, 0.5); updateImageTransform(); }); zoomReset.addEventListener('click', (e) => { e.stopPropagation(); resetImagePosition(); }); // Mouse drag functionality modalImage.addEventListener('mousedown', (e) => { if (currentZoom <= 1) return; isDragging = true; startX = e.clientX - currentX; startY = e.clientY - currentY; modalImage.style.cursor = 'grabbing'; }); document.addEventListener('mousemove', (e) => { if (!isDragging) return; e.preventDefault(); currentX = e.clientX - startX; currentY = e.clientY - startY; updateImageTransform(); }); document.addEventListener('mouseup', () => { isDragging = false; modalImage.style.cursor = currentZoom > 1 ? 'grab' : 'zoom-out'; }); // Touch support for mobile let lastTouchDistance = 0; modalImage.addEventListener('touchstart', (e) => { if (e.touches.length === 2) { lastTouchDistance = Math.sqrt( Math.pow(e.touches[0].clientX - e.touches[1].clientX, 2) + Math.pow(e.touches[0].clientY - e.touches[1].clientY, 2) ); } }); modalImage.addEventListener('touchmove', (e) => { if (e.touches.length === 2) { e.preventDefault(); const currentDistance = Math.sqrt( Math.pow(e.touches[0].clientX - e.touches[1].clientX, 2) + Math.pow(e.touches[0].clientY - e.touches[1].clientY, 2) ); if (lastTouchDistance > 0) { const scale = currentDistance / lastTouchDistance; currentZoom = Math.min(Math.max(currentZoom * scale, 0.5), 4); updateImageTransform(); } lastTouchDistance = currentDistance; } }); // Close events modalClose.addEventListener('click', closeModal); modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); }); document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && modal.classList.contains('active')) { closeModal(); } }); // Mouse wheel zoom modal.addEventListener('wheel', (e) => { if (modal.classList.contains('active')) { e.preventDefault(); const delta = e.deltaY > 0 ? 0.9 : 1.1; currentZoom = Math.min(Math.max(currentZoom * delta, 0.5), 4); updateImageTransform(); } }); } function openModal(imageSrc, title, description) { if (!imageSrc || imageSrc === PLACEHOLDER) return; const modal = document.getElementById('imageModal'); const modalImage = document.getElementById('modalImage'); const modalTitle = document.getElementById('modalTitle'); const modalDescription = document.getElementById('modalDescription'); modalImage.src = imageSrc; modalTitle.textContent = title; modalDescription.textContent = description; modal.classList.add('active'); document.body.style.overflow = 'hidden'; resetImagePosition(); // Show info after delay setTimeout(() => modal.classList.add('show-info'), 500); } function closeModal() { const modal = document.getElementById('imageModal'); modal.classList.remove('active', 'show-info'); document.body.style.overflow = ''; resetImagePosition(); } function resetImagePosition() { currentZoom = 1; currentX = 0; currentY = 0; updateImageTransform(); } function updateImageTransform() { const modalImage = document.getElementById('modalImage'); modalImage.style.transform = `translate(${currentX}px, ${currentY}px) scale(${currentZoom})`; } // Funciones de importar/exportar ARREGLADAS function exportData() { const data = { products: products, categories: categories, warehouses: warehouses, logo: localStorage.getItem('libomi_logo_v2') }; document.getElementById('exportData').value = JSON.stringify(data, null, 2); showToast('Datos exportados'); } function importData() { const jsonData = document.getElementById('importData').value.trim(); if (!jsonData) { showToast('Pega los datos JSON para importar', 'error'); return; } try { const data = JSON.parse(jsonData); if (data.products && Array.isArray(data.products)) { products = data.products; } if (data.categories && typeof data.categories === 'object') { categories = data.categories; } if (data.warehouses && Array.isArray(data.warehouses)) { warehouses = data.warehouses; } if (data.logo) { localStorage.setItem('libomi_logo_v2', data.logo); loadLogo(); } // ESTO ERA EL PROBLEMA: Faltaba actualizar la UI después de importar saveData(); // Guardar en localStorage // Actualizar TODA la interfaz renderWarehouses(); renderCategories(); renderProducts(); renderCatalog(); renderWarehouseList(); renderCategoryLists(); updatePrintHeader(); showToast('Datos importados exitosamente'); document.getElementById('importData').value = ''; // Forzar actualización si estamos en alguna sección específica const activeSection = document.querySelector('.section.active'); if (activeSection) { const sectionId = activeSection.id; if (sectionId === 'catalogo') { renderCatalog(); } else if (sectionId === 'categorias') { renderCategoryLists(); } else if (sectionId === 'almacenes') { renderWarehouseList(); } else if (sectionId === 'productos') { renderProducts(); } } } catch (error) { console.error('Error parsing JSON:', error); showToast('Error en el formato JSON', 'error'); } } function resetAllData() { if (confirm('¿Estás seguro de que quieres borrar todos los datos? Esta acción no se puede deshacer.')) { products = []; categories = {"General": ["Varios"]}; warehouses = ["Almacén Principal"]; localStorage.removeItem('libomi_products_v2'); localStorage.removeItem('libomi_categories_v2'); localStorage.removeItem('libomi_warehouses_v2'); localStorage.removeItem('libomi_logo_v2'); clearLogo(); renderWarehouses(); renderCategories(); renderProducts(); renderCatalog(); clearForm(); showToast('Todos los datos han sido eliminados', 'warning'); } } // Función de impresión function printCatalog() { updatePrintHeader(); window.print(); } function updatePrintHeader() { const printDate = document.getElementById('printDate'); const printLogo = document.getElementById('printLogo'); if (printDate) { const now = new Date(); printDate.textContent = now.toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' }); } if (printLogo) { const logoSrc = localStorage.getItem('libomi_logo_v2') || localStorage.getItem('libomi_logo'); printLogo.src = logoSrc || document.getElementById('logoImage').src; } } </script></body></html>
